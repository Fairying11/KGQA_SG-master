<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>人物关系查询</title>
    <script src="{{ url_for('static', filename='js/jquery-2.2.4.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/echarts.min.js') }}"></script>
</head>
<body>
    <div class="container">
        <h3>人物关系查询</h3>
        <div class="input-group">
            <input type="text" id="keyword" placeholder="输入人物名称">
            <button onclick="queryRelation()">查询</button>
        </div>
        <div id="graph" style="width: 100%; height: 600px; margin-top: 20px;"></div>
    </div>

    <script>
        // 调用关系查询接口（对应步骤2-30、2-43）
        function queryRelation() {
            const keyword = $("#keyword").val().trim();
            if (!keyword) return alert("请输入人物名称");

            $.ajax({
                url: "/relationship",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ "keyword": keyword }),
                success: function(res) {
                    if (res.status === 200) {
                        renderGraph(res.respon);
                    } else {
                        alert("未找到相关数据");
                    }
                }
            });
        }

        // 可视化图谱（对应步骤2-45）
        function renderGraph(data) {
            const chart = echarts.init(document.getElementById("graph"));
            const option = {
                series: [{
                    type: "graph",
                    layout: "force",
                    force: { repulsion: 200 },
                    nodes: data.nodes.map(node => ({
                        name: node.text,
                        id: node.id,
                        symbolSize: 50
                    })),
                    links: data.lines.map(line => ({
                        source: line.from,
                        target: line.to,
                        label: { show: true, formatter: line.text }
                    }))
                }]
            };
            chart.setOption(option);
        }
    </script>
</body>
</html>
